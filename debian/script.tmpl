#!/bin/bash

# Update the package manager data and install wget
sudo apt update
sudo apt-get install --assume-yes wget

# Download the Debian Linux Chrome Remote Desktop installation package
wget https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb

#Install the package and its dependencies
sudo dpkg --install chrome-remote-desktop_current_amd64.deb
sudo apt install --assume-yes --fix-broken

# Installing an X Windows System (Xfce) desktop environment
sudo DEBIAN_FRONTEND=noninteractive apt install --assume-yes xfce4 desktop-base

# Configure Chrome Remote Desktop to use Xfce by default
sudo bash -c 'echo "exec /etc/X11/Xsession /usr/bin/xfce4-session" > /etc/chrome-remote-desktop-session'

# Xfce's default screen locker is Light Locker, which doesn't work with Chrome Remote Desktop. (The screen locker displays a blank screen and cannot be unlocked). Therefore, install XScreenSaver as an alternative:
sudo apt install --assume-yes xscreensaver

# Optionally, install the full suite of Linux desktop applications, including the Firefox browser, LibreOffice office application suite, and the Evince PDF viewer
sudo apt install --assume-yes task-xfce-desktop

# Disable the display manager service on your instance. There is no display connected to your instance, so the display manager service won't start
sudo systemctl disable lightdm.service

# Optionally, install the Chrome browser on your instance
wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
sudo dpkg --install google-chrome-stable_current_amd64.deb
sudo apt install --assume-yes --fix-broken

# Create this file to indicate the completion of this script
cat "# DESKTOP SUCCESSFULLY INSTALLED!!!" > /tmp/chromedesktop_installed.txt
